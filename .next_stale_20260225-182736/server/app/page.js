(()=>{var a={};a.id=974,a.ids=[974],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},707:()=>{},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},955:()=>{},967:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(7954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/delaneyfoley/Developer/projects/vlm-eval copy/src/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/delaneyfoley/Developer/projects/vlm-eval copy/src/app/page.tsx","default")},1025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},1135:()=>{},1472:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f,metadata:()=>e});var d=c(5338);c(1135);let e={title:"VLM Eval — Prompt-Based Detection Evaluator",description:"Evaluate prompt-based binary detections with VLMs"};function f({children:a}){return(0,d.jsx)("html",{lang:"en",children:(0,d.jsx)("body",{className:"bg-gray-950 text-gray-100 min-h-screen antialiased",children:a})})}},2784:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,4160,23)),Promise.resolve().then(c.t.bind(c,1603,23)),Promise.resolve().then(c.t.bind(c,8495,23)),Promise.resolve().then(c.t.bind(c,5170,23)),Promise.resolve().then(c.t.bind(c,7526,23)),Promise.resolve().then(c.t.bind(c,8922,23)),Promise.resolve().then(c.t.bind(c,9234,23)),Promise.resolve().then(c.t.bind(c,2263,23)),Promise.resolve().then(c.bind(c,2146))},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:a=>{"use strict";a.exports=require("path")},3904:(a,b,c)=>{Promise.resolve().then(c.bind(c,8933))},4176:(a,b,c)=>{Promise.resolve().then(c.bind(c,967))},6018:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(9754),e=c(9117),f=c(6595),g=c(2324),h=c(9326),i=c(8928),j=c(175),k=c(12),l=c(4290),m=c(2696),n=c(2802),o=c(7533),p=c(5229),q=c(2822),r=c(261),s=c(6453),t=c(2474),u=c(6713),v=c(1356),w=c(2685),x=c(6225),y=c(3446),z=c(2762),A=c(5742),B=c(6439),C=c(1170),D=c.n(C),E=c(2506),F=c(1203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,967)),"/Users/delaneyfoley/Developer/projects/vlm-eval copy/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,1472)),"/Users/delaneyfoley/Developer/projects/vlm-eval copy/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,1170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,7028,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,2768,23)),"next/dist/client/components/builtin/unauthorized.js"]}],I=["/Users/delaneyfoley/Developer/projects/vlm-eval copy/src/app/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(3873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},8354:a=>{"use strict";a.exports=require("util")},8933:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>G});var d=c(1124),e=c(8301);let f=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},g=a=>{let b=(a=>a?f(a):f)(a),c=a=>(function(a,b=a=>a){let c=e.useSyncExternalStore(a.subscribe,e.useCallback(()=>b(a.getState()),[a,b]),e.useCallback(()=>b(a.getInitialState()),[a,b]));return e.useDebugValue(c),c})(b,a);return Object.assign(c,b),c},h=(a=>a?g(a):g)(a=>({selectedDetectionId:null,setSelectedDetectionId:b=>a({selectedDetectionId:b}),activeTab:0,setActiveTab:b=>a({activeTab:b}),apiKey:"",setApiKey:b=>a({apiKey:b}),selectedModel:"gemini-2.5-flash",setSelectedModel:b=>a({selectedModel:b}),selectedRunByDetection:{},setSelectedRunForDetection:(b,c)=>a(a=>({selectedRunByDetection:{...a.selectedRunByDetection,[b]:c}})),clearSelectedRunForDetection:b=>a(a=>{let c={...a.selectedRunByDetection};return delete c[b],{selectedRunByDetection:c}}),refreshCounter:0,triggerRefresh:()=>a(a=>({refreshCounter:a.refreshCounter+1}))})),i=["gemini-3.1-flash","gemini-3.1-pro","gemini-3-flash","gemini-3-pro","gemini-2.5-flash","gemini-2.5-pro","gemini-2.0-flash"];function j({metrics:a,label:b,compact:c}){let e=a=>(100*a).toFixed(1)+"%";return c?(0,d.jsxs)("div",{className:"flex gap-3 text-xs",children:[(0,d.jsxs)("span",{children:["P: ",(0,d.jsx)("b",{className:"text-blue-400",children:e(a.precision)})]}),(0,d.jsxs)("span",{children:["R: ",(0,d.jsx)("b",{className:"text-green-400",children:e(a.recall)})]}),(0,d.jsxs)("span",{children:["F1: ",(0,d.jsx)("b",{className:"text-yellow-400",children:e(a.f1)})]}),(0,d.jsxs)("span",{children:["Acc: ",(0,d.jsx)("b",{className:"text-gray-300",children:e(a.accuracy)})]})]}):(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[b&&(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:b}),(0,d.jsxs)("div",{className:"grid grid-cols-5 gap-3 mb-4",children:[(0,d.jsx)(k,{label:"Precision",value:e(a.precision),color:"text-blue-400"}),(0,d.jsx)(k,{label:"Recall",value:e(a.recall),color:"text-green-400"}),(0,d.jsx)(k,{label:"F1 Score",value:e(a.f1),color:"text-yellow-400"}),(0,d.jsx)(k,{label:"Accuracy",value:e(a.accuracy),color:"text-gray-200"}),(0,d.jsx)(k,{label:"Prevalence",value:e(a.prevalence),color:"text-purple-400"})]}),(0,d.jsxs)("div",{className:"flex gap-6 items-start",children:[(0,d.jsxs)("div",{className:"shrink-0",children:[(0,d.jsx)("p",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Confusion Matrix"}),(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-0 text-xs",children:[(0,d.jsx)("div",{}),(0,d.jsx)("div",{className:"text-center text-gray-500 pb-1 px-2",children:"Pred +"}),(0,d.jsx)("div",{className:"text-center text-gray-500 pb-1 px-2",children:"Pred −"}),(0,d.jsx)("div",{className:"text-gray-500 pr-2 text-right",children:"Act +"}),(0,d.jsx)("div",{className:"bg-green-900/30 border border-green-800/50 px-3 py-2 text-center font-mono text-green-400",children:a.tp}),(0,d.jsx)("div",{className:"bg-red-900/30 border border-red-800/50 px-3 py-2 text-center font-mono text-red-400",children:a.fn}),(0,d.jsx)("div",{className:"text-gray-500 pr-2 text-right",children:"Act −"}),(0,d.jsx)("div",{className:"bg-red-900/30 border border-red-800/50 px-3 py-2 text-center font-mono text-red-400",children:a.fp}),(0,d.jsx)("div",{className:"bg-green-900/30 border border-green-800/50 px-3 py-2 text-center font-mono text-green-400",children:a.tn})]})]}),(0,d.jsxs)("div",{className:"text-xs space-y-1 text-gray-400",children:[(0,d.jsxs)("p",{children:["Total: ",(0,d.jsx)("span",{className:"text-white",children:a.total})]}),(0,d.jsxs)("p",{children:["TP: ",(0,d.jsx)("span",{className:"text-green-400",children:a.tp})," | FP: ",(0,d.jsx)("span",{className:"text-red-400",children:a.fp})]}),(0,d.jsxs)("p",{children:["FN: ",(0,d.jsx)("span",{className:"text-red-400",children:a.fn})," | TN: ",(0,d.jsx)("span",{className:"text-green-400",children:a.tn})]}),(0,d.jsxs)("p",{children:["Parse failures: ",(0,d.jsx)("span",{className:a.parse_failure_rate>0?"text-yellow-400":"text-gray-400",children:e(a.parse_failure_rate)})]})]})]})]})}function k({label:a,value:b,color:c}){return(0,d.jsxs)("div",{className:"bg-gray-900/50 rounded px-3 py-2 text-center",children:[(0,d.jsx)("div",{className:`text-lg font-semibold ${c}`,children:b}),(0,d.jsx)("div",{className:"text-xs text-gray-500",children:a})]})}function l({detections:a,selectedDetection:b,onRefresh:c}){let{apiKey:f,selectedModel:g,setSelectedDetectionId:i,setActiveTab:k,setSelectedRunForDetection:l}=h(),[o,p]=(0,e.useState)("view"),[q,r]=(0,e.useState)([]),[s,t]=(0,e.useState)([]),[u,v]=(0,e.useState)([]),[w,x]=(0,e.useState)(""),[y,z]=(0,e.useState)(""),[A,B]=(0,e.useState)(null),[C,D]=(0,e.useState)([]),[E,F]=(0,e.useState)("all"),[G,H]=(0,e.useState)(!1),[I,J]=(0,e.useState)(null),[K,L]=(0,e.useState)(!1),[M,N]=(0,e.useState)(!1),[O,P]=(0,e.useState)({detection_code:"",display_name:"",description:"",label_policy:"",decision_rubric:[""],metric_thresholds:{primary_metric:"f1",min_precision:.8,min_recall:.8,min_f1:.8}}),Q=(0,e.useCallback)(async()=>{if(!b)return;let[a,c,d]=await Promise.all([fetch(`/api/prompts?detection_id=${b.detection_id}`),fetch(`/api/datasets?detection_id=${b.detection_id}`),fetch(`/api/runs?detection_id=${b.detection_id}`)]);r(await a.json()),t(await c.json()),v(await d.json())},[b]),R=async()=>{if(b){if(!f)return void alert("Set your Gemini API key first.");if(!w||!y)return void alert("Choose a prompt and dataset before running.");H(!0),B(null),D([]),J(null);try{let a=await fetch("/api/runs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:f,model_override:g,prompt_version_id:w,dataset_id:y,detection_id:b.detection_id})}),c=await a.json();if(!c?.run_id)return void alert(c?.error||"Run failed");let d=await fetch(`/api/runs?run_id=${c.run_id}`),e=await d.json();B(e),D(e.predictions||[]),l(b.detection_id,e.run_id),Q()}catch(a){console.error(a),alert("Run failed")}finally{H(!1)}}},S=C.filter(a=>{switch(E){case"fp":return a.parse_ok&&"DETECTED"===a.predicted_decision&&"NOT_DETECTED"===a.ground_truth_label;case"fn":return a.parse_ok&&"NOT_DETECTED"===a.predicted_decision&&"DETECTED"===a.ground_truth_label;case"parse_fail":return!a.parse_ok;case"correct":return a.parse_ok&&a.predicted_decision===a.ground_truth_label;default:return!0}}),T=async()=>{let a=await fetch("/api/detections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...O,decision_rubric:O.decision_rubric.filter(a=>a.trim())})});i((await a.json()).detection_id),p("view"),c()},U=async()=>{b&&(await fetch("/api/detections",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({detection_id:b.detection_id,display_name:O.display_name,description:O.description,label_policy:O.label_policy,decision_rubric:O.decision_rubric.filter(a=>a.trim()),metric_thresholds:O.metric_thresholds,approved_prompt_version:b.approved_prompt_version})}),p("view"),c())},V=()=>{P({detection_code:"",display_name:"",description:"",label_policy:"",decision_rubric:[""],metric_thresholds:{primary_metric:"f1",min_precision:.8,min_recall:.8,min_f1:.8}}),p("create")};return(0,d.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Detection Setup"}),(0,d.jsxs)("div",{className:"flex gap-2",children:["view"===o&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:V,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded text-sm",children:"New Detection"}),b&&(0,d.jsx)("button",{onClick:()=>{b&&(P({detection_code:b.detection_code,display_name:b.display_name,description:b.description,label_policy:b.label_policy,decision_rubric:b.decision_rubric.length>0?b.decision_rubric:[""],metric_thresholds:b.metric_thresholds}),p("edit"))},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-sm",children:"Edit"})]}),"view"!==o&&(0,d.jsx)("button",{onClick:()=>p("view"),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-sm",children:"Cancel"})]})]}),"view"!==o&&(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6 space-y-4",children:[(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-300",children:"create"===o?"Create Detection":"Edit Detection"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Detection Code"}),(0,d.jsx)("input",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm disabled:opacity-50",value:O.detection_code,onChange:a=>P({...O,detection_code:a.target.value.toUpperCase().replace(/[^A-Z0-9_]/g,"")}),disabled:"edit"===o,placeholder:"e.g. SMOKE_VISIBLE"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Display Name"}),(0,d.jsx)("input",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm",value:O.display_name,onChange:a=>P({...O,display_name:a.target.value}),placeholder:"e.g. Visible Smoke Detection"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Description"}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm h-20",value:O.description,onChange:a=>P({...O,description:a.target.value})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Label Policy (DETECTED / NOT_DETECTED / Edge Cases)"}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm h-24",value:O.label_policy,onChange:a=>P({...O,label_policy:a.target.value})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Decision Rubric (3-7 criteria)"}),O.decision_rubric.map((a,b)=>(0,d.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,d.jsxs)("span",{className:"text-xs text-gray-500 mt-2",children:[b+1,"."]}),(0,d.jsx)("input",{className:"flex-1 bg-gray-900 border border-gray-600 rounded px-3 py-1.5 text-sm",value:a,onChange:a=>{let c=[...O.decision_rubric];c[b]=a.target.value,P({...O,decision_rubric:c})}}),O.decision_rubric.length>1&&(0,d.jsx)("button",{onClick:()=>P({...O,decision_rubric:O.decision_rubric.filter((a,c)=>c!==b)}),className:"text-gray-500 hover:text-red-400 text-xs",children:"Remove"})]},b)),O.decision_rubric.length<7&&(0,d.jsx)("button",{onClick:()=>P({...O,decision_rubric:[...O.decision_rubric,""]}),className:"text-xs text-blue-400 hover:text-blue-300",children:"+ Add criterion"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-2",children:"Metric Thresholds"}),(0,d.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-500",children:"Primary Metric"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm mt-1",value:O.metric_thresholds.primary_metric,onChange:a=>P({...O,metric_thresholds:{...O.metric_thresholds,primary_metric:a.target.value}}),children:[(0,d.jsx)("option",{value:"precision",children:"Precision"}),(0,d.jsx)("option",{value:"recall",children:"Recall"}),(0,d.jsx)("option",{value:"f1",children:"F1"})]})]}),["min_precision","min_recall","min_f1"].map(a=>(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-500",children:a.replace("min_","Min ")}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"1",className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm mt-1",value:O.metric_thresholds[a]??"",onChange:b=>P({...O,metric_thresholds:{...O.metric_thresholds,[a]:parseFloat(b.target.value)||void 0}})})]},a))]})]}),(0,d.jsx)("button",{onClick:"create"===o?T:U,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm font-medium",children:"create"===o?"Create Detection":"Save Changes"})]}),"view"===o&&b&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:b.display_name}),(0,d.jsx)("code",{className:"text-xs text-gray-400 bg-gray-900 px-2 py-0.5 rounded mt-1 inline-block",children:b.detection_code})]}),b.approved_prompt_version&&(0,d.jsx)("span",{className:"text-xs bg-green-900/30 text-green-400 border border-green-800/50 px-2 py-1 rounded",children:"Approved prompt set"})]}),(0,d.jsx)("p",{className:"text-sm text-gray-400 mb-3",children:b.description}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-1",children:"Label Policy"}),(0,d.jsx)("p",{className:"text-gray-300 whitespace-pre-wrap text-xs",children:b.label_policy})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-1",children:"Decision Rubric"}),(0,d.jsx)("ol",{className:"list-decimal list-inside text-xs text-gray-300 space-y-0.5",children:b.decision_rubric.map((a,b)=>(0,d.jsx)("li",{children:a},b))})]})]}),(0,d.jsxs)("div",{className:"mt-3 flex gap-4 text-xs text-gray-400",children:[(0,d.jsxs)("span",{children:["Primary: ",(0,d.jsx)("b",{className:"text-gray-300",children:b.metric_thresholds.primary_metric})]}),null!=b.metric_thresholds.min_precision&&(0,d.jsxs)("span",{children:["Min Prec: ",(0,d.jsx)("b",{children:b.metric_thresholds.min_precision})]}),null!=b.metric_thresholds.min_recall&&(0,d.jsxs)("span",{children:["Min Recall: ",(0,d.jsx)("b",{children:b.metric_thresholds.min_recall})]}),null!=b.metric_thresholds.min_f1&&(0,d.jsxs)("span",{children:["Min F1: ",(0,d.jsx)("b",{children:b.metric_thresholds.min_f1})]})]})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium",children:["Prompt Versions (",q.length,")"]}),(0,d.jsx)("button",{onClick:()=>L(!K),className:"text-xs px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded",children:K?"Cancel":"New Prompt Version"})]}),K&&(0,d.jsx)(m,{detectionId:b.detection_id,detectionCode:b.detection_code,onSaved:()=>{L(!1),Q()}}),(0,d.jsxs)("div",{className:"space-y-2",children:[q.map(a=>(0,d.jsxs)("div",{className:`border rounded-lg p-3 text-sm ${a.prompt_version_id===b.approved_prompt_version?"border-green-700 bg-green-900/10":"border-gray-700 bg-gray-900/30"}`,children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:a.version_label}),(0,d.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:[a.model," | temp=",a.temperature]}),a.prompt_version_id===b.approved_prompt_version&&(0,d.jsx)("span",{className:"ml-2 text-xs text-green-400",children:"APPROVED"})]}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleDateString()})]}),a.change_notes&&(0,d.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:a.change_notes}),a.golden_set_regression_result&&(0,d.jsx)("div",{className:"mt-2 text-xs",children:(0,d.jsxs)("span",{className:a.golden_set_regression_result.passed?"text-green-400":"text-red-400",children:["Regression: ",a.golden_set_regression_result.passed?"PASSED":"FAILED"]})})]},a.prompt_version_id)),0===q.length&&(0,d.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No prompt versions yet. Create one to get started."})]})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-medium",children:"Initial Run and Prompt Iteration"}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Run on an iteration dataset, inspect outcomes and previews, then iterate quickly."})]}),(0,d.jsx)("button",{onClick:R,disabled:G||!w||!y,className:"text-xs px-3 py-1.5 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 rounded",children:G?"Running...":"Run Now"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Prompt Version"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2.5 py-2 text-sm",value:w,onChange:a=>x(a.target.value),children:[(0,d.jsx)("option",{value:"",children:"Select prompt"}),q.map(a=>(0,d.jsxs)("option",{value:a.prompt_version_id,children:[a.version_label," | ",a.model," | temp=",a.temperature]},a.prompt_version_id))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Dataset"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2.5 py-2 text-sm",value:y,onChange:a=>z(a.target.value),children:[(0,d.jsx)("option",{value:"",children:"Select dataset"}),s.filter(a=>"HELD_OUT_EVAL"!==a.split_type).map(a=>(0,d.jsxs)("option",{value:a.dataset_id,children:[a.name," (",a.split_type,", ",a.size," images)"]},a.dataset_id))]})]})]}),A&&A.metrics_summary&&(0,d.jsx)(j,{metrics:A.metrics_summary,label:`Run ${A.run_id.slice(0,8)} Results`}),C.length>0&&(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("div",{className:"flex gap-2 flex-wrap",children:[["all","All"],["fp","False Positives"],["fn","False Negatives"],["parse_fail","Parse Failures"],["correct","Correct"]].map(([a,b])=>(0,d.jsx)("button",{onClick:()=>F(a),className:`text-xs px-2.5 py-1 rounded-full ${E===a?"bg-blue-600 text-white":"bg-gray-900 text-gray-400 border border-gray-700 hover:bg-gray-800"}`,children:b},a))}),(0,d.jsx)("div",{className:"overflow-x-auto max-h-[420px] overflow-y-auto border border-gray-700 rounded-lg",children:(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{className:"sticky top-0 bg-gray-800 z-10",children:(0,d.jsxs)("tr",{className:"text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Image"}),(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Preview"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Ground Truth"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Prediction"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Confidence"}),(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Evidence"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Parse"})]})}),(0,d.jsx)("tbody",{children:S.map(a=>(0,d.jsxs)("tr",{className:"border-b border-gray-800/60 hover:bg-gray-800/40",children:[(0,d.jsx)("td",{className:"py-2 px-3 font-mono text-gray-300",children:a.image_id}),(0,d.jsx)("td",{className:"py-2 px-3",children:(0,d.jsx)("img",{src:a.image_uri,alt:a.image_id,className:"w-12 h-9 object-cover rounded cursor-pointer hover:opacity-80",onClick:()=>J(a.image_uri)})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:`px-1.5 py-0.5 rounded ${"DETECTED"===a.ground_truth_label?"bg-green-900/30 text-green-400":"bg-gray-800 text-gray-400"}`,children:a.ground_truth_label})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:`px-1.5 py-0.5 rounded ${"DETECTED"===a.predicted_decision?"bg-green-900/30 text-green-400":"NOT_DETECTED"===a.predicted_decision?"bg-gray-800 text-gray-400":"bg-red-900/30 text-red-400"}`,children:a.predicted_decision||"PARSE_FAIL"})}),(0,d.jsx)("td",{className:"text-right py-2 px-3 text-gray-300",children:null!=a.confidence?a.confidence.toFixed(2):"—"}),(0,d.jsx)("td",{className:"py-2 px-3 text-gray-400 truncate max-w-[340px]",children:a.evidence||"—"}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:a.parse_ok?"text-green-400":"text-red-400",children:a.parse_ok?"OK":"FAIL"})})]},a.prediction_id))})]})}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("button",{onClick:()=>k(1),className:"text-xs px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded",children:"Continue to HIL Review"}),(0,d.jsx)("p",{className:"text-xs text-gray-500",children:"The latest run is carried into HIL and Prompt Feedback."})]})]})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium",children:["Datasets (",s.length,")"]}),(0,d.jsx)("button",{onClick:()=>N(!M),className:"text-xs px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded",children:M?"Cancel":"Upload Dataset"})]}),M&&(0,d.jsx)(n,{detectionId:b.detection_id,onUploaded:()=>{N(!1),Q()}}),(0,d.jsxs)("div",{className:"space-y-2",children:[s.map(a=>(0,d.jsxs)("div",{className:"border border-gray-700 bg-gray-900/30 rounded-lg p-3 flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-sm font-medium",children:a.name}),(0,d.jsx)("span",{className:`ml-2 text-xs px-1.5 py-0.5 rounded ${function(a){switch(a){case"GOLDEN":return"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50";case"ITERATION":return"bg-blue-900/30 text-blue-400 border border-blue-800/50";case"HELD_OUT_EVAL":return"bg-purple-900/30 text-purple-400 border border-purple-800/50";default:return"bg-gray-800 text-gray-400"}}(a.split_type)}`,children:a.split_type})]}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:[a.size," images"]})]},a.dataset_id)),0===s.length&&(0,d.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No datasets yet. Upload one to begin evaluation."})]})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium mb-4",children:["Recent Runs (",u.length,")"]}),(0,d.jsxs)("div",{className:"space-y-2",children:[u.slice(0,10).map(a=>(0,d.jsxs)("div",{className:"border border-gray-700 bg-gray-900/30 rounded-lg p-3 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-xs font-mono text-gray-400",children:a.run_id.slice(0,8)}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleString()})]}),(0,d.jsxs)("div",{className:"flex gap-4 mt-1 text-xs text-gray-400",children:[(0,d.jsxs)("span",{children:["Split: ",(0,d.jsx)("b",{children:a.split_type})]}),(0,d.jsxs)("span",{children:["Status: ",(0,d.jsx)("b",{className:"completed"===a.status?"text-green-400":"text-yellow-400",children:a.status})]}),a.metrics_summary?.f1!=null&&(0,d.jsxs)("span",{children:["F1: ",(0,d.jsxs)("b",{className:"text-yellow-400",children:[(100*a.metrics_summary.f1).toFixed(1),"%"]})]})]})]},a.run_id)),0===u.length&&(0,d.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No runs yet."})]})]})]}),"view"===o&&!b&&(0,d.jsxs)("div",{className:"text-center py-20",children:[(0,d.jsx)("p",{className:"text-gray-500 mb-4",children:"No detection selected."}),(0,d.jsx)("button",{onClick:V,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm",children:"Create Your First Detection"}),(0,d.jsxs)("div",{className:"mt-8 max-w-2xl mx-auto text-left bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Getting Started"}),(0,d.jsxs)("ol",{className:"list-decimal list-inside text-xs text-gray-400 space-y-2",children:[(0,d.jsx)("li",{children:"Set your Gemini API key using the button in the top-right corner"}),(0,d.jsx)("li",{children:"Create a detection with a stable code, label policy, and decision rubric"}),(0,d.jsx)("li",{children:"Create prompt versions with structured sections"}),(0,d.jsx)("li",{children:"Upload a dataset (JSON manifest with image_id, image_uri, ground_truth_label)"}),(0,d.jsx)("li",{children:"Run the initial iteration here to inspect outcomes and refine prompts"}),(0,d.jsx)("li",{children:"Use HIL Review to correct predictions and improve ground truth"}),(0,d.jsx)("li",{children:"Use Prompt Feedback to analyze errors and create improved prompt versions"}),(0,d.jsx)("li",{children:"Use Prompt Compare to compare baseline vs improved prompts"}),(0,d.jsx)("li",{children:"Run Held-Out Eval for final evaluation before approval"})]}),(0,d.jsxs)("div",{className:"mt-4 bg-gray-900 rounded p-3 text-xs font-mono text-gray-400",children:[(0,d.jsx)("p",{className:"text-gray-500 mb-1",children:"Dataset manifest format (JSON array):"}),`[
  { "image_id": "img_001", "image_uri": "https://...", "ground_truth_label": "DETECTED" },
  { "image_id": "img_002", "image_uri": "./path/to/image.jpg", "ground_truth_label": "NOT_DETECTED" }
]`]})]})]}),I&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-6",onClick:()=>J(null),children:(0,d.jsx)("img",{src:I,alt:"Preview",className:"max-h-[90vh] max-w-[90vw] rounded-lg border border-gray-700"})})]})}function m({detectionId:a,detectionCode:b,onSaved:c,initialData:f}){let[g,h]=(0,e.useState)({version_label:f?.version_label||"",system_prompt:f?.system_prompt||`You are a visual detection system. Your task is to analyze images for a specific detection type and return a structured JSON response.

You must ONLY return valid JSON matching the exact schema provided. No markdown, no commentary, no extra text.`,user_prompt_template:f?.user_prompt_template||`Analyze this image for the detection: {{DETECTION_CODE}}

Return ONLY this JSON:
{
  "detection_code": "{{DETECTION_CODE}}",
  "decision": "DETECTED" or "NOT_DETECTED",
  "confidence": <float 0-1>,
  "evidence": "<short phrase describing visual basis>"
}`,prompt_structure:f?.prompt_structure||{detection_identity:"",label_policy:"",decision_rubric:"",output_schema:`{"detection_code":"${b}","decision":"DETECTED|NOT_DETECTED","confidence":0.0,"evidence":"short phrase"}`,examples:""},model:f?.model||"gemini-2.5-flash",temperature:f?.temperature??0,top_p:f?.top_p??1,max_output_tokens:f?.max_output_tokens??1024,change_notes:"",created_by:"user"}),i=async()=>{await fetch("/api/prompts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...g,detection_id:a})}),c()};return(0,d.jsxs)("div",{className:"border border-gray-600 rounded-lg p-4 mb-4 space-y-3 bg-gray-900/50",children:[(0,d.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Version Label"}),(0,d.jsx)("input",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:g.version_label,onChange:a=>h({...g,version_label:a.target.value}),placeholder:"v1.1"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Model"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:g.model,onChange:a=>h({...g,model:a.target.value}),children:[(0,d.jsx)("option",{value:"gemini-2.5-flash",children:"gemini-2.5-flash"}),(0,d.jsx)("option",{value:"gemini-2.5-pro",children:"gemini-2.5-pro"}),(0,d.jsx)("option",{value:"gemini-2.0-flash",children:"gemini-2.0-flash"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Temperature"}),(0,d.jsx)("input",{type:"number",step:"0.1",min:"0",max:"2",className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:g.temperature,onChange:a=>h({...g,temperature:parseFloat(a.target.value)||0})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Max Tokens"}),(0,d.jsx)("input",{type:"number",className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:g.max_output_tokens,onChange:a=>h({...g,max_output_tokens:parseInt(a.target.value)||1024})})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"System Prompt"}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm font-mono h-24",value:g.system_prompt,onChange:a=>h({...g,system_prompt:a.target.value})})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("label",{className:"text-xs text-gray-400 block mb-1",children:["User Prompt Template ",(0,d.jsxs)("span",{className:"text-gray-600",children:["(use ","{{DETECTION_CODE}}"," as placeholder)"]})]}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm font-mono h-40",value:g.user_prompt_template,onChange:a=>h({...g,user_prompt_template:a.target.value})})]}),(0,d.jsxs)("details",{className:"text-sm",children:[(0,d.jsx)("summary",{className:"text-xs text-gray-400 cursor-pointer hover:text-gray-300",children:"Structured Prompt Sections (optional)"}),(0,d.jsx)("div",{className:"mt-2 space-y-2",children:["detection_identity","label_policy","decision_rubric","output_schema","examples"].map(a=>(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-500 block mb-1",children:a.replace(/_/g," ")}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-xs font-mono h-16",value:g.prompt_structure[a]||"",onChange:b=>h({...g,prompt_structure:{...g.prompt_structure,[a]:b.target.value}})})]},a))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Change Notes"}),(0,d.jsx)("input",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:g.change_notes,onChange:a=>h({...g,change_notes:a.target.value})})]}),(0,d.jsx)("button",{onClick:i,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm",children:"Save Prompt Version"})]})}function n({detectionId:a,onUploaded:b}){let[c,f]=(0,e.useState)(""),[g,h]=(0,e.useState)("ITERATION"),[i,j]=(0,e.useState)(""),[k,l]=(0,e.useState)(""),m=async()=>{l("");try{let d=JSON.parse(i);if(!Array.isArray(d))return void l("Must be a JSON array");for(let a of d)if(!a.image_id||!a.image_uri||!["DETECTED","NOT_DETECTED"].includes(a.ground_truth_label))return void l("Each item must have image_id, image_uri, and ground_truth_label (DETECTED|NOT_DETECTED)");await fetch("/api/datasets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:c,detection_id:a,split_type:g,items:d})}),b()}catch{l("Invalid JSON format")}};return(0,d.jsxs)("div",{className:"border border-gray-600 rounded-lg p-4 mb-4 space-y-3 bg-gray-900/50",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Dataset Name"}),(0,d.jsx)("input",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:c,onChange:a=>f(a.target.value),placeholder:"My Dataset"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Split Type"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm",value:g,onChange:a=>h(a.target.value),children:[(0,d.jsx)("option",{value:"GOLDEN",children:"GOLDEN (regression gate)"}),(0,d.jsx)("option",{value:"ITERATION",children:"ITERATION (can be corrected via HIL)"}),(0,d.jsx)("option",{value:"HELD_OUT_EVAL",children:"HELD_OUT_EVAL (protected, final eval)"}),(0,d.jsx)("option",{value:"CUSTOM",children:"CUSTOM"})]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Dataset Manifest (JSON array)"}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-xs font-mono h-32",value:i,onChange:a=>j(a.target.value),placeholder:`[
  { "image_id": "img_001", "image_uri": "https://example.com/image1.jpg", "ground_truth_label": "DETECTED" },
  { "image_id": "img_002", "image_uri": "https://example.com/image2.jpg", "ground_truth_label": "NOT_DETECTED" }
]`})]}),k&&(0,d.jsx)("p",{className:"text-xs text-red-400",children:k}),(0,d.jsx)("button",{onClick:m,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm",children:"Upload Dataset"})]})}function o({detection:a}){let{apiKey:b,selectedModel:c}=h(),[f,g]=(0,e.useState)([]),[i,k]=(0,e.useState)([]),[l,m]=(0,e.useState)([]),[n,o]=(0,e.useState)(""),[s,t]=(0,e.useState)(!1),[u,v]=(0,e.useState)(""),[w,x]=(0,e.useState)(new Map);(0,e.useCallback)(async()=>{let[b,c]=await Promise.all([fetch(`/api/prompts?detection_id=${a.detection_id}`),fetch(`/api/datasets?detection_id=${a.detection_id}`)]),d=await b.json(),e=await c.json();g(d),k(e.filter(a=>"GOLDEN"===a.split_type||"ITERATION"===a.split_type||"CUSTOM"===a.split_type))},[a.detection_id]);let y=async()=>{if(!b)return void alert("Set your Gemini API key first");if(l.length<1)return void alert("Select at least 1 prompt version");if(!n)return void alert("Select a dataset");t(!0),x(new Map);for(let d=0;d<l.length;d++){let e=l[d],g=f.find(a=>a.prompt_version_id===e);v(`Running prompt ${d+1}/${l.length}: ${g?.version_label||e.slice(0,8)}...`);try{let d=await fetch("/api/runs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:b,model_override:c,prompt_version_id:e,dataset_id:n,detection_id:a.detection_id})}),f=await d.json(),g=await fetch(`/api/runs?run_id=${f.run_id}`),h=await g.json();x(a=>{let b=new Map(a);return b.set(e,{run:h,predictions:h.predictions}),b})}catch(a){console.error("Run failed:",a)}}t(!1),v("")},z=Array.from(w.entries()),A=new Map;if(z.length>=2){let a=new Set;for(let[,{predictions:b}]of z)for(let c of b)a.add(c.image_id);for(let b of a){let a=new Map;for(let[c,{predictions:d}]of z){let e=d.find(a=>a.image_id===b);a.set(c,e?.predicted_decision||null)}new Set(Array.from(a.values())).size>1&&A.set(b,a)}}return(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Prompt Compare"}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs text-gray-400 font-medium mb-2",children:"Select 2–4 Prompt Versions"}),(0,d.jsx)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:f.map(b=>(0,d.jsxs)("label",{className:`flex items-center gap-2 p-2 rounded border cursor-pointer text-sm ${l.includes(b.prompt_version_id)?"border-blue-600 bg-blue-900/20":"border-gray-700 bg-gray-900/30 hover:border-gray-600"}`,children:[(0,d.jsx)("input",{type:"checkbox",checked:l.includes(b.prompt_version_id),onChange:()=>{var a;return a=b.prompt_version_id,void m(b=>b.includes(a)?b.filter(b=>b!==a):b.length>=4?b:[...b,a])},className:"rounded"}),(0,d.jsx)("span",{children:b.version_label}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:[b.model," | temp=",b.temperature]}),b.prompt_version_id===a.approved_prompt_version&&(0,d.jsx)("span",{className:"text-xs text-green-400 ml-auto",children:"APPROVED"})]},b.prompt_version_id))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs text-gray-400 font-medium mb-2",children:"Select Dataset"}),(0,d.jsx)("div",{className:"space-y-1.5",children:i.map(a=>(0,d.jsxs)("label",{className:`flex items-center gap-2 p-2 rounded border cursor-pointer text-sm ${n===a.dataset_id?"border-blue-600 bg-blue-900/20":"border-gray-700 bg-gray-900/30 hover:border-gray-600"}`,children:[(0,d.jsx)("input",{type:"radio",name:"dataset",checked:n===a.dataset_id,onChange:()=>o(a.dataset_id)}),(0,d.jsx)("span",{children:a.name}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:[a.size," images"]}),(0,d.jsx)("span",{className:`text-xs ml-auto px-1.5 py-0.5 rounded ${function(a){switch(a){case"GOLDEN":return"bg-yellow-900/30 text-yellow-400";case"ITERATION":return"bg-blue-900/30 text-blue-400";case"HELD_OUT_EVAL":return"bg-purple-900/30 text-purple-400";default:return"bg-gray-800 text-gray-400"}}(a.split_type)}`,children:a.split_type})]},a.dataset_id))}),(0,d.jsxs)("div",{className:"mt-3 p-2 bg-gray-900/50 rounded border border-gray-700 text-xs text-gray-400",children:[(0,d.jsx)("b",{children:"Locked params:"})," All prompts will run with the same dataset and images. Temperature/top_p stay per-prompt. Model uses the app-level selection."]})]})]}),(0,d.jsxs)("div",{className:"mt-4 flex items-center gap-4",children:[(0,d.jsx)("button",{onClick:y,disabled:s||l.length<1||!n,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-medium",children:s?"Running...":"Run Comparison"}),u&&(0,d.jsx)("span",{className:"text-sm text-gray-400",children:u})]})]}),z.length>0&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:z.map(([a,{run:b}])=>{let c=f.find(b=>b.prompt_version_id===a);return(0,d.jsx)(j,{metrics:b.metrics_summary,label:`${c?.version_label||a.slice(0,8)} — ${c?.model}`},a)})}),z.length>=2&&(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Metric Deltas (vs first prompt)"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"text-xs text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Prompt"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Precision"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Recall"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"F1"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Accuracy"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Parse Fail %"})]})}),(0,d.jsx)("tbody",{children:z.map(([a,{run:b}],c)=>{let e=f.find(b=>b.prompt_version_id===a),g=b.metrics_summary,h=z[0][1].run.metrics_summary,i=0===c;return(0,d.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,d.jsxs)("td",{className:"py-2 px-3 font-medium",children:[e?.version_label,i&&(0,d.jsx)("span",{className:"text-xs text-gray-500 ml-1",children:"(baseline)"})]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3",children:[r(g.precision),!i&&(0,d.jsx)(q,{value:g.precision-h.precision})]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3",children:[r(g.recall),!i&&(0,d.jsx)(q,{value:g.recall-h.recall})]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3",children:[r(g.f1),!i&&(0,d.jsx)(q,{value:g.f1-h.f1})]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3",children:[r(g.accuracy),!i&&(0,d.jsx)(q,{value:g.accuracy-h.accuracy})]}),(0,d.jsx)("td",{className:"text-right py-2 px-3",children:r(g.parse_failure_rate)})]},a)})})]})})]}),A.size>0&&(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium mb-3",children:["Disagreement Cases (",A.size," images)"]}),(0,d.jsx)("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{className:"sticky top-0 bg-gray-800",children:(0,d.jsxs)("tr",{className:"text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Image ID"}),z.map(([a])=>{let b=f.find(b=>b.prompt_version_id===a);return(0,d.jsx)("th",{className:"text-center py-2 px-3",children:b?.version_label},a)})]})}),(0,d.jsx)("tbody",{children:Array.from(A.entries()).map(([a,b])=>(0,d.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,d.jsx)("td",{className:"py-2 px-3 font-mono",children:a}),z.map(([a])=>{let c=b.get(a);return(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:`px-1.5 py-0.5 rounded text-xs ${"DETECTED"===c?"bg-green-900/30 text-green-400":"NOT_DETECTED"===c?"bg-gray-800 text-gray-400":"bg-red-900/30 text-red-400"}`,children:c||"PARSE_FAIL"})},a)})]},a))})]})})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Full Outcomes"}),z.map(([a,{predictions:b}])=>{let c=f.find(b=>b.prompt_version_id===a);return(0,d.jsxs)("details",{className:"mb-3",children:[(0,d.jsxs)("summary",{className:"cursor-pointer text-sm text-gray-300 hover:text-white",children:[c?.version_label," — ",b.length," predictions"]}),(0,d.jsx)("div",{className:"mt-2 overflow-x-auto max-h-72 overflow-y-auto",children:(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{className:"sticky top-0 bg-gray-800",children:(0,d.jsxs)("tr",{className:"text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-1.5 px-2",children:"Image"}),(0,d.jsx)("th",{className:"text-center py-1.5 px-2",children:"Ground Truth"}),(0,d.jsx)("th",{className:"text-center py-1.5 px-2",children:"Prediction"}),(0,d.jsx)("th",{className:"text-center py-1.5 px-2",children:"Correct"}),(0,d.jsx)("th",{className:"text-right py-1.5 px-2",children:"Confidence"}),(0,d.jsx)("th",{className:"text-left py-1.5 px-2",children:"Evidence"}),(0,d.jsx)("th",{className:"text-center py-1.5 px-2",children:"Parse"})]})}),(0,d.jsx)("tbody",{children:b.map(a=>{let b=a.parse_ok&&a.predicted_decision===a.ground_truth_label;return(0,d.jsxs)("tr",{className:"border-b border-gray-800/50",children:[(0,d.jsx)("td",{className:"py-1.5 px-2 font-mono",children:a.image_id}),(0,d.jsx)("td",{className:"text-center py-1.5 px-2",children:(0,d.jsx)(p,{decision:a.ground_truth_label})}),(0,d.jsx)("td",{className:"text-center py-1.5 px-2",children:(0,d.jsx)(p,{decision:a.predicted_decision})}),(0,d.jsx)("td",{className:"text-center py-1.5 px-2",children:b?(0,d.jsx)("span",{className:"text-green-400",children:"✓"}):(0,d.jsx)("span",{className:"text-red-400",children:"✗"})}),(0,d.jsx)("td",{className:"text-right py-1.5 px-2",children:null!=a.confidence?a.confidence.toFixed(2):"—"}),(0,d.jsx)("td",{className:"py-1.5 px-2 text-gray-400 max-w-[200px] truncate",children:a.evidence||"—"}),(0,d.jsx)("td",{className:"text-center py-1.5 px-2",children:a.parse_ok?(0,d.jsx)("span",{className:"text-green-400 text-xs",children:"OK"}):(0,d.jsx)("span",{className:"text-red-400 text-xs",children:"FAIL"})})]},a.prediction_id)})})]})})]},a)})]})]})]})}function p({decision:a}){return a?(0,d.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${"DETECTED"===a?"bg-green-900/30 text-green-400":"bg-gray-800 text-gray-400"}`,children:"DETECTED"===a?"DET":"NOT"}):(0,d.jsx)("span",{className:"text-gray-600 text-xs",children:"—"})}function q({value:a}){let b=(100*a).toFixed(1);return(0,d.jsxs)("span",{className:`ml-1 text-xs ${a>0?"text-green-400":a<0?"text-red-400":"text-gray-500"}`,children:["(",a>0?"+":"",b,")"]})}function r(a){return(100*a).toFixed(1)+"%"}let s=["MISSED_DETECTION","FALSE_POSITIVE","AMBIGUOUS_IMAGE","LABEL_POLICY_GAP","PROMPT_INSTRUCTION_GAP","SCHEMA_VIOLATION"];function t({detection:a}){let{selectedRunByDetection:b,setSelectedRunForDetection:c}=h(),[f,g]=(0,e.useState)([]),i=b[a.detection_id]||"",[j,k]=(0,e.useState)(i),[l,m]=(0,e.useState)([]),[n,o]=(0,e.useState)("all"),[p,q]=(0,e.useState)("table"),[r,s]=(0,e.useState)(0),[t,w]=(0,e.useState)(null);(0,e.useCallback)(async()=>{let b=await fetch(`/api/runs?detection_id=${a.detection_id}`);g((await b.json()).filter(a=>"completed"===a.status))},[a.detection_id]),(0,e.useCallback)(async()=>{if(!j)return;let a=await fetch(`/api/runs?run_id=${j}`),b=await a.json();w(b),m(b.predictions||[]),s(0)},[j]);let x=l.filter(a=>{let b=a.corrected_label||a.ground_truth_label;switch(n){case"fp":return a.parse_ok&&"DETECTED"===a.predicted_decision&&"NOT_DETECTED"===b;case"fn":return a.parse_ok&&"NOT_DETECTED"===a.predicted_decision&&"DETECTED"===b;case"parse_fail":return!a.parse_ok;case"correct":return a.parse_ok&&a.predicted_decision===b;case"corrected":return null!==a.corrected_label;default:return!0}}),y=async(a,b)=>{await fetch("/api/hil",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({prediction_id:a,...b,update_ground_truth:b.update_ground_truth??t?.split_type==="ITERATION"})}),m(c=>c.map(c=>c.prediction_id===a?{...c,corrected_label:void 0!==b.corrected_label?b.corrected_label:c.corrected_label,error_tag:void 0!==b.error_tag?b.error_tag:c.error_tag,reviewer_note:void 0!==b.reviewer_note?b.reviewer_note:c.reviewer_note,corrected_at:new Date().toISOString()}:c))},z=x[r];return(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Human-in-the-Loop Review"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:()=>q("table"),className:`px-3 py-1.5 text-sm rounded ${"table"===p?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"}`,children:"Table View"}),(0,d.jsx)("button",{onClick:()=>q("image"),className:`px-3 py-1.5 text-sm rounded ${"image"===p?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"}`,children:"Image Review"})]})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("label",{className:"text-xs text-gray-400",children:"Select Run:"}),(0,d.jsxs)("select",{className:"bg-gray-900 border border-gray-600 rounded px-3 py-1.5 text-sm flex-1",value:j,onChange:b=>{let d=b.target.value;k(d),d&&c(a.detection_id,d)},children:[(0,d.jsx)("option",{value:"",children:"Choose a run..."}),f.map(a=>(0,d.jsxs)("option",{value:a.run_id,children:[a.run_id.slice(0,8)," — ",a.split_type," — F1: ",(100*(a.metrics_summary?.f1||0)).toFixed(1),"% — ",new Date(a.created_at).toLocaleString()]},a.run_id))]})]}),l.length>0&&(0,d.jsx)("div",{className:"flex gap-2 mt-3",children:[["all","All"],["fp","False Positives"],["fn","False Negatives"],["parse_fail","Parse Failures"],["correct","Correct"],["corrected","Corrected"]].map(([a,b])=>{let c=l.filter(b=>{let c=b.corrected_label||b.ground_truth_label;switch(a){case"fp":return b.parse_ok&&"DETECTED"===b.predicted_decision&&"NOT_DETECTED"===c;case"fn":return b.parse_ok&&"NOT_DETECTED"===b.predicted_decision&&"DETECTED"===c;case"parse_fail":return!b.parse_ok;case"correct":return b.parse_ok&&b.predicted_decision===c;case"corrected":return null!==b.corrected_label;default:return!0}}).length;return(0,d.jsxs)("button",{onClick:()=>{o(a),s(0)},className:`px-3 py-1 text-xs rounded-full ${n===a?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[b," (",c,")"]},a)})})]}),"table"===p&&x.length>0&&(0,d.jsx)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg overflow-hidden",children:(0,d.jsx)("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{className:"sticky top-0 bg-gray-800 z-10",children:(0,d.jsxs)("tr",{className:"text-xs text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2.5 px-3",children:"Image"}),(0,d.jsx)("th",{className:"text-left py-2.5 px-3",children:"Thumbnail"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-3",children:"Predicted"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-3",children:"Ground Truth"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-3",children:"Corrected?"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-3",children:"Error Tag"}),(0,d.jsx)("th",{className:"text-right py-2.5 px-3",children:"Confidence"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-3",children:"Parse"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-3",children:"Actions"})]})}),(0,d.jsx)("tbody",{children:x.map((a,b)=>(0,d.jsx)(u,{prediction:a,onUpdate:y,onImageReview:()=>{s(b),q("image")},isIteration:t?.split_type==="ITERATION"},a.prediction_id))})]})})}),"image"===p&&z&&(0,d.jsx)(v,{prediction:z,index:r,total:x.length,onNext:()=>s(a=>Math.min(a+1,x.length-1)),onPrev:()=>s(a=>Math.max(a-1,0)),onUpdate:y,isIteration:t?.split_type==="ITERATION"}),l.length>0&&0===x.length&&(0,d.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No predictions match the selected filter."}),!j&&(0,d.jsx)("p",{className:"text-center text-gray-500 py-8",children:"Select a completed run to begin review."})]})}function u({prediction:a,onUpdate:b,onImageReview:c,isIteration:e}){let f=a.corrected_label||a.ground_truth_label,g=a.parse_ok&&a.predicted_decision===f;return(0,d.jsxs)("tr",{className:`border-b border-gray-800/50 hover:bg-gray-800/30 ${!g?"bg-red-900/5":""}`,children:[(0,d.jsx)("td",{className:"py-2 px-3 font-mono text-xs",children:a.image_id}),(0,d.jsx)("td",{className:"py-2 px-3",children:(0,d.jsx)("img",{src:a.image_uri,alt:a.image_id,className:"w-10 h-10 object-cover rounded cursor-pointer hover:opacity-80",onClick:c})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${"DETECTED"===a.predicted_decision?"bg-green-900/30 text-green-400":"NOT_DETECTED"===a.predicted_decision?"bg-gray-800 text-gray-400":"bg-red-900/30 text-red-400"}`,children:a.predicted_decision||"PARSE_FAIL"})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:`text-xs px-1.5 py-0.5 rounded ${"DETECTED"===a.ground_truth_label?"bg-green-900/30 text-green-400":"bg-gray-800 text-gray-400"}`,children:"DETECTED"===a.ground_truth_label?"DET":"NOT"})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:a.corrected_label?(0,d.jsx)("span",{className:"text-xs text-yellow-400",children:"DETECTED"===a.corrected_label?"→DET":"→NOT"}):(0,d.jsx)("span",{className:"text-gray-600 text-xs",children:"—"})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsxs)("select",{className:"bg-gray-900 border border-gray-700 rounded text-xs px-1 py-0.5",value:a.error_tag||"",onChange:c=>b(a.prediction_id,{error_tag:c.target.value||null}),children:[(0,d.jsx)("option",{value:"",children:"—"}),s.map(a=>(0,d.jsx)("option",{value:a,children:a},a))]})}),(0,d.jsx)("td",{className:"text-right py-2 px-3 text-xs",children:null!=a.confidence?a.confidence.toFixed(2):"—"}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:a.parse_ok?(0,d.jsx)("span",{className:"text-green-400 text-xs",children:"OK"}):(0,d.jsx)("span",{className:"text-red-400 text-xs",children:"FAIL"})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("button",{onClick:c,className:"text-xs text-blue-400 hover:text-blue-300",children:"Review"})})]})}function v({prediction:a,index:b,total:c,onNext:f,onPrev:g,onUpdate:h,isIteration:i}){let[j,k]=(0,e.useState)(a.reviewer_note||"");return(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-6",onKeyDown:a=>{("ArrowRight"===a.key||"n"===a.key)&&f(),("ArrowLeft"===a.key||"p"===a.key)&&g()},tabIndex:0,children:[(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:[b+1," / ",c," — ",a.image_id]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:g,disabled:0===b,className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-30 rounded text-xs",children:"← Prev"}),(0,d.jsx)("button",{onClick:f,disabled:b===c-1,className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-30 rounded text-xs",children:"Next →"})]})]}),(0,d.jsx)("img",{src:a.image_uri,alt:a.image_id,className:"w-full max-h-[500px] object-contain rounded bg-gray-900"})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:"Model Response"}),(0,d.jsx)("pre",{className:"text-xs font-mono bg-gray-900 rounded p-3 overflow-x-auto whitespace-pre-wrap text-gray-300",children:a.raw_response}),!a.parse_ok&&(0,d.jsx)("p",{className:"text-xs text-red-400 mt-2",children:"Parse failed — response did not match expected schema"})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:"Label Correction"}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("span",{className:"text-xs text-gray-400",children:"Ground truth:"}),(0,d.jsx)("span",{className:`text-sm font-medium ${"DETECTED"===a.ground_truth_label?"text-green-400":"text-gray-400"}`,children:a.ground_truth_label})]}),a.corrected_label&&(0,d.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(0,d.jsx)("span",{className:"text-xs text-gray-400",children:"Corrected to:"}),(0,d.jsx)("span",{className:`text-sm font-medium ${"DETECTED"===a.corrected_label?"text-green-400":"text-gray-400"}`,children:a.corrected_label})]}),(0,d.jsxs)("button",{onClick:()=>{let b="DETECTED"===(a.corrected_label||a.ground_truth_label)?"NOT_DETECTED":"DETECTED";h(a.prediction_id,{corrected_label:b})},className:"mt-3 px-4 py-2 bg-yellow-600 hover:bg-yellow-500 rounded text-sm",children:["Toggle → ","DETECTED"===(a.corrected_label||a.ground_truth_label)?"NOT_DETECTED":"DETECTED"]}),i&&(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Corrections will update ground truth for ITERATION datasets."}),a.corrected_label&&(0,d.jsx)("button",{onClick:()=>h(a.prediction_id,{corrected_label:null}),className:"mt-2 text-xs text-gray-500 hover:text-gray-300 underline",children:"Reset correction"})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:"Error Tag"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm",value:a.error_tag||"",onChange:b=>h(a.prediction_id,{error_tag:b.target.value||null}),children:[(0,d.jsx)("option",{value:"",children:"No tag"}),s.map(a=>(0,d.jsx)("option",{value:a,children:a},a))]})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:"Reviewer Note"}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm h-20",value:j,onChange:a=>k(a.target.value),placeholder:"Add observations..."}),(0,d.jsx)("button",{onClick:()=>h(a.prediction_id,{reviewer_note:j||null}),className:"mt-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Save Note"})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-500 space-y-0.5",children:[(0,d.jsxs)("p",{children:["Confidence: ",null!=a.confidence?a.confidence.toFixed(3):"N/A"," (uncalibrated)"]}),(0,d.jsxs)("p",{children:["Evidence: ",a.evidence||"—"]}),(0,d.jsxs)("p",{children:["Prediction: ",a.predicted_decision||"PARSE_FAIL"]})]})]})]})}function w({detection:a}){let{apiKey:b,selectedModel:c,selectedRunByDetection:f,setSelectedRunForDetection:g}=h(),[i,k]=(0,e.useState)([]),l=f[a.detection_id]||"",[m,n]=(0,e.useState)(l),[o,p]=(0,e.useState)(null),[q,r]=(0,e.useState)(null),[s,t]=(0,e.useState)([]),[u,v]=(0,e.useState)([]),[w,x]=(0,e.useState)(!1),[y,z]=(0,e.useState)(new Set),[A,B]=(0,e.useState)(!1),C=(0,e.useCallback)(async()=>{let[b,c]=await Promise.all([fetch(`/api/runs?detection_id=${a.detection_id}`),fetch(`/api/prompts?detection_id=${a.detection_id}`)]);k((await b.json()).filter(a=>"completed"===a.status)),t(await c.json())},[a.detection_id]);(0,e.useCallback)(async()=>{if(!m)return;let a=await fetch(`/api/runs?run_id=${m}`);p(await a.json()),r(null),v([])},[m]);let D=async()=>{if(!m)return;let a=await fetch("/api/hil",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({run_id:m})});r((await a.json()).metrics)},E=async()=>{if(!b)return void alert("Set your Gemini API key first");if(!o)return;x(!0);let d=s.find(a=>a.prompt_version_id===o.prompt_version_id);if(!d)return void x(!1);try{let e=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:b,model_override:c,predictions:o.predictions,prompt:d,detection:a})}),f=await e.json();f.suggestions?v(f.suggestions):alert(f.error||"Failed to get suggestions")}catch(a){console.error(a)}x(!1)},F=a=>{z(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},G=async()=>{if(0===y.size||!o)return;let d=s.find(a=>a.prompt_version_id===o.prompt_version_id);if(!d)return;B(!0);let e=d.system_prompt,f=d.user_prompt_template;for(let a of y){let b=u[a];"system_prompt"===b.section?e=e.replace(b.old_text,b.new_text):f=f.replace(b.old_text,b.new_text)}let g=s.length+1,h=Array.from(y).map(a=>u[a].rationale).join("; ");try{let k=await fetch("/api/prompts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({detection_id:a.detection_id,version_label:`v${g}.0`,system_prompt:e,user_prompt_template:f,prompt_structure:d.prompt_structure,model:d.model,temperature:d.temperature,top_p:d.top_p,max_output_tokens:d.max_output_tokens,change_notes:`AI-suggested edits: ${h}`,created_by:"ai-assistant"})}),l=await k.json(),m=await fetch(`/api/datasets?detection_id=${a.detection_id}`),n=(await m.json()).find(a=>"GOLDEN"===a.split_type);if(n&&b){var i,j;let d=await fetch("/api/runs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:b,model_override:c,prompt_version_id:l.prompt_version_id,dataset_id:n.dataset_id,detection_id:a.detection_id})}),e=await d.json(),f=a.metric_thresholds,g=(i=e.metrics,j=f,(null==j.min_precision||!(i.precision<j.min_precision))&&(null==j.min_recall||!(i.recall<j.min_recall))&&(null==j.min_f1||!(i.f1<j.min_f1)));await fetch("/api/prompts",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt_version_id:l.prompt_version_id,golden_set_regression_result:{passed:g,run_id:e.run_id,metrics:e.metrics,previous_metrics:q||o?.metrics_summary,evaluated_at:new Date().toISOString()}})}),alert(`New prompt version saved. Golden regression: ${g?"PASSED":"FAILED"}`)}else alert("New prompt version saved. No golden dataset found for regression.");C()}catch(a){console.error(a)}B(!1)},H=q||o?.metrics_summary;return(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Post-HIL Metrics & Prompt Improvement"}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("label",{className:"text-xs text-gray-400",children:"Select Run:"}),(0,d.jsxs)("select",{className:"bg-gray-900 border border-gray-600 rounded px-3 py-1.5 text-sm flex-1",value:m,onChange:b=>{let c=b.target.value;n(c),c&&g(a.detection_id,c)},children:[(0,d.jsx)("option",{value:"",children:"Choose a run..."}),i.map(a=>(0,d.jsxs)("option",{value:a.run_id,children:[a.run_id.slice(0,8)," — ",a.split_type," — ",new Date(a.created_at).toLocaleString()]},a.run_id))]}),(0,d.jsx)("button",{onClick:D,disabled:!m,className:"px-4 py-1.5 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 rounded text-sm",children:"Recompute Metrics"})]}),q&&(0,d.jsx)("p",{className:"text-xs text-green-400 mt-2",children:"Metrics recomputed with HIL corrections applied."})]}),H&&(0,d.jsx)(j,{metrics:H,label:q?"Recomputed Metrics (Post-HIL)":"Original Run Metrics"}),o&&(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,d.jsx)("h3",{className:"text-sm font-medium",children:"Prompt Improvement Assistant"}),(0,d.jsx)("button",{onClick:E,disabled:w,className:"px-4 py-1.5 bg-purple-600 hover:bg-purple-500 disabled:opacity-50 rounded text-sm",children:w?"Analyzing...":"Analyze Errors & Suggest Edits"})]}),(0,d.jsx)("p",{className:"text-xs text-gray-400 mb-4",children:"The assistant will analyze clustered FPs, FNs, error tags, and representative correct predictions to propose up to 5 targeted prompt edits. It will not rewrite the entire prompt or change the output schema."}),u.length>0&&(0,d.jsxs)("div",{className:"space-y-3",children:[u.map((a,b)=>(0,d.jsx)("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${y.has(b)?"border-purple-600 bg-purple-900/10":"border-gray-700 bg-gray-900/30 hover:border-gray-600"}`,onClick:()=>F(b),children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsx)("input",{type:"checkbox",checked:y.has(b),onChange:()=>F(b),className:"mt-1"}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,d.jsx)("span",{className:"text-xs bg-gray-800 px-2 py-0.5 rounded text-gray-400",children:a.section}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["→ ",a.failure_cluster]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs font-mono",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-red-400 text-xs font-sans",children:"OLD:"}),(0,d.jsx)("div",{className:"bg-red-900/10 border border-red-900/30 rounded p-2 mt-1 whitespace-pre-wrap text-red-300",children:a.old_text})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-green-400 text-xs font-sans",children:"NEW:"}),(0,d.jsx)("div",{className:"bg-green-900/10 border border-green-900/30 rounded p-2 mt-1 whitespace-pre-wrap text-green-300",children:a.new_text})]})]}),(0,d.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:a.rationale})]})]})},b)),(0,d.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,d.jsx)("button",{onClick:G,disabled:0===y.size||A,className:"px-4 py-2 bg-green-600 hover:bg-green-500 disabled:opacity-50 rounded text-sm font-medium",children:A?"Saving...":`Accept ${y.size} Edit(s) & Save as New Version`}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"A golden set regression will run automatically after saving."})]})]})]})]})}function x({detection:a}){let[b,c]=(0,e.useState)([]),[f,g]=(0,e.useState)(null),[h,i]=(0,e.useState)([]),[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(!1),n=(0,e.useCallback)(async()=>{let b=await fetch(`/api/datasets?detection_id=${a.detection_id}`);c(await b.json())},[a.detection_id]);(0,e.useCallback)(async()=>{if(!f)return void i([]);m(!0);let a=await fetch(`/api/datasets?dataset_id=${f}`);i((await a.json()).items||[]),m(!1)},[f]);let o=async a=>{confirm("Delete this dataset and all its items? This cannot be undone.")&&(await fetch("/api/datasets",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataset_id:a})}),f===a&&(g(null),i([])),n())},p=b.find(a=>a.dataset_id===f),q=a=>h.filter(b=>b.ground_truth_label===a).length;return(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Dataset Manager"}),(0,d.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Upload, inspect, and manage datasets for"," ",(0,d.jsx)("span",{className:"text-gray-300",children:a.display_name})]})]}),(0,d.jsx)("button",{onClick:()=>k(!j),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm font-medium",children:j?"Cancel":"Upload New Dataset"})]}),j&&(0,d.jsx)(y,{detectionId:a.detection_id,onUploaded:()=>{k(!1),n()}}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[b.map(a=>(0,d.jsxs)("div",{onClick:()=>g(a.dataset_id),className:`border rounded-lg p-4 cursor-pointer transition-all ${f===a.dataset_id?"border-blue-500 bg-blue-900/10 ring-1 ring-blue-500/30":"border-gray-700 bg-gray-800/40 hover:border-gray-600 hover:bg-gray-800/60"}`,children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,d.jsx)("h3",{className:"font-medium text-sm text-gray-200 truncate flex-1",children:a.name}),(0,d.jsx)("span",{className:`text-xs px-2 py-0.5 rounded ml-2 shrink-0 ${z(a.split_type)}`,children:a.split_type})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-400 mt-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)("svg",{className:"w-3.5 h-3.5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,d.jsxs)("span",{children:[a.size," images"]})]}),(0,d.jsx)("span",{className:"text-gray-600",children:"|"}),(0,d.jsxs)("span",{className:"font-mono text-gray-500",title:"Dataset hash",children:["#",a.dataset_hash.slice(0,8)]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-3 pt-3 border-t border-gray-700/50",children:[(0,d.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleDateString()}),(0,d.jsx)("button",{onClick:b=>{b.stopPropagation(),o(a.dataset_id)},className:"text-xs text-gray-600 hover:text-red-400 transition-colors",children:"Delete"})]})]},a.dataset_id)),0===b.length&&(0,d.jsxs)("div",{className:"col-span-full text-center py-12 text-gray-500",children:[(0,d.jsx)("p",{className:"text-sm",children:"No datasets yet for this detection."}),(0,d.jsx)("button",{onClick:()=>k(!0),className:"mt-3 text-sm text-blue-400 hover:text-blue-300",children:"Upload your first dataset"})]})]}),p&&(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg overflow-hidden",children:[(0,d.jsxs)("div",{className:"px-5 py-4 border-b border-gray-700 bg-gray-800/30",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-medium text-gray-200",children:p.name}),(0,d.jsxs)("div",{className:"flex items-center gap-3 mt-1.5 text-xs text-gray-400",children:[(0,d.jsx)("span",{className:`px-2 py-0.5 rounded ${z(p.split_type)}`,children:p.split_type}),(0,d.jsxs)("span",{children:[p.size," images"]}),(0,d.jsxs)("span",{className:"font-mono text-gray-500",children:["hash: ",p.dataset_hash]})]})]}),(0,d.jsxs)("div",{className:"flex gap-3 text-xs",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-lg font-semibold text-green-400",children:q("DETECTED")}),(0,d.jsx)("div",{className:"text-gray-500",children:"DETECTED"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-lg font-semibold text-gray-400",children:q("NOT_DETECTED")}),(0,d.jsx)("div",{className:"text-gray-500",children:"NOT_DET"})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-lg font-semibold text-purple-400",children:h.length>0?(q("DETECTED")/h.length*100).toFixed(0)+"%":"—"}),(0,d.jsx)("div",{className:"text-gray-500",children:"Prevalence"})]})]})]}),"HELD_OUT_EVAL"===p.split_type&&(0,d.jsx)("div",{className:"mt-3 bg-purple-900/15 border border-purple-800/40 rounded px-3 py-2 text-xs text-purple-400",children:"This is a protected held-out dataset. Items cannot be edited."}),"GOLDEN"===p.split_type&&(0,d.jsx)("div",{className:"mt-3 bg-yellow-900/15 border border-yellow-800/40 rounded px-3 py-2 text-xs text-yellow-400",children:"Golden set — used for regression gating. Changes will affect regression results."})]}),(0,d.jsx)("div",{className:"overflow-x-auto max-h-[500px] overflow-y-auto",children:l?(0,d.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Loading items..."}):(0,d.jsxs)("table",{className:"w-full text-sm",children:[(0,d.jsx)("thead",{className:"sticky top-0 bg-gray-800 z-10",children:(0,d.jsxs)("tr",{className:"text-xs text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2.5 px-4 w-12",children:"#"}),(0,d.jsx)("th",{className:"text-left py-2.5 px-4",children:"Image ID"}),(0,d.jsx)("th",{className:"text-left py-2.5 px-4",children:"Preview"}),(0,d.jsx)("th",{className:"text-left py-2.5 px-4",children:"Image URI"}),(0,d.jsx)("th",{className:"text-center py-2.5 px-4",children:"Ground Truth"})]})}),(0,d.jsx)("tbody",{children:h.map((a,b)=>(0,d.jsxs)("tr",{className:"border-b border-gray-800/50 hover:bg-gray-800/30",children:[(0,d.jsx)("td",{className:"py-2 px-4 text-xs text-gray-600",children:b+1}),(0,d.jsx)("td",{className:"py-2 px-4 font-mono text-xs text-gray-300",children:a.image_id}),(0,d.jsx)("td",{className:"py-2 px-4",children:(0,d.jsx)("img",{src:a.image_uri,alt:a.image_id,className:"w-12 h-9 object-cover rounded border border-gray-700",onError:a=>{a.target.style.display="none"}})}),(0,d.jsx)("td",{className:"py-2 px-4 text-xs text-gray-400 max-w-[300px] truncate font-mono",children:a.image_uri}),(0,d.jsx)("td",{className:"text-center py-2 px-4",children:(0,d.jsx)("span",{className:`text-xs px-2 py-0.5 rounded ${"DETECTED"===a.ground_truth_label?"bg-green-900/30 text-green-400 border border-green-800/40":"bg-gray-800 text-gray-400 border border-gray-700"}`,children:"DETECTED"===a.ground_truth_label?"DETECTED":"NOT_DETECTED"})})]},a.item_id))})]})}),(0,d.jsx)("div",{className:"px-5 py-3 border-t border-gray-700 bg-gray-900/30",children:(0,d.jsxs)("details",{className:"text-xs text-gray-500",children:[(0,d.jsx)("summary",{className:"cursor-pointer hover:text-gray-400",children:"Dataset manifest format"}),(0,d.jsx)("pre",{className:"mt-2 bg-gray-900 rounded p-3 font-mono text-gray-400 overflow-x-auto",children:`[
  {
    "image_id": "unique_id",
    "image_uri": "https://... or ./local/path.jpg",
    "ground_truth_label": "DETECTED" | "NOT_DETECTED"
  }
]`})]})})]})]})}function y({detectionId:a,onUploaded:b}){let[c,f]=(0,e.useState)(""),[g,h]=(0,e.useState)("ITERATION"),[i,j]=(0,e.useState)(""),[k,l]=(0,e.useState)(""),[m,n]=(0,e.useState)(!1),o=async()=>{l("");try{let d=JSON.parse(i);if(!Array.isArray(d))return void l("Must be a JSON array");if(0===d.length)return void l("Dataset must contain at least one item");for(let a=0;a<d.length;a++){let b=d[a];if(!b.image_id||!b.image_uri||!["DETECTED","NOT_DETECTED"].includes(b.ground_truth_label))return void l(`Item ${a}: Each item must have image_id, image_uri, and ground_truth_label (DETECTED|NOT_DETECTED)`)}if(!c.trim())return void l("Dataset name is required");n(!0),await fetch("/api/datasets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:c.trim(),detection_id:a,split_type:g,items:d})}),b()}catch{l("Invalid JSON format. Ensure it is a valid JSON array.")}finally{n(!1)}};return(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5 space-y-4",children:[(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-300",children:"Upload New Dataset"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Dataset Name"}),(0,d.jsx)("input",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500",value:c,onChange:a=>f(a.target.value),placeholder:"e.g. Smoke Test Set v2"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Split Type"}),(0,d.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500",value:g,onChange:a=>h(a.target.value),children:[(0,d.jsx)("option",{value:"ITERATION",children:"ITERATION — for prompt development, corrections via HIL"}),(0,d.jsx)("option",{value:"GOLDEN",children:"GOLDEN — fixed regression gate set"}),(0,d.jsx)("option",{value:"HELD_OUT_EVAL",children:"HELD_OUT_EVAL — protected final evaluation"}),(0,d.jsx)("option",{value:"CUSTOM",children:"CUSTOM — general purpose"})]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Dataset Manifest (JSON array)"}),(0,d.jsx)("textarea",{className:"w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-xs font-mono h-40 focus:outline-none focus:border-blue-500",value:i,onChange:a=>j(a.target.value),placeholder:`[
  { "image_id": "img_001", "image_uri": "https://example.com/img1.jpg", "ground_truth_label": "DETECTED" },
  { "image_id": "img_002", "image_uri": "https://example.com/img2.jpg", "ground_truth_label": "NOT_DETECTED" }
]`})]}),k&&(0,d.jsx)("div",{className:"bg-red-900/20 border border-red-800/50 rounded px-3 py-2 text-xs text-red-400",children:k}),(0,d.jsx)("button",{onClick:o,disabled:m,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 rounded text-sm font-medium",children:m?"Uploading...":"Upload Dataset"})]})}function z(a){switch(a){case"GOLDEN":return"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50";case"ITERATION":return"bg-blue-900/30 text-blue-400 border border-blue-800/50";case"HELD_OUT_EVAL":return"bg-purple-900/30 text-purple-400 border border-purple-800/50";default:return"bg-gray-800 text-gray-400 border border-gray-700"}}function A({detection:a}){let{apiKey:b,selectedModel:c}=h(),[f,g]=(0,e.useState)([]),[i,k]=(0,e.useState)([]),[l,m]=(0,e.useState)([]),[n,o]=(0,e.useState)(""),[p,q]=(0,e.useState)(""),[r,s]=(0,e.useState)(!1),[t,u]=(0,e.useState)(""),[v,w]=(0,e.useState)(null),[x,y]=(0,e.useState)(!1),z=(0,e.useCallback)(async()=>{let[b,c,d]=await Promise.all([fetch(`/api/prompts?detection_id=${a.detection_id}`),fetch(`/api/datasets?detection_id=${a.detection_id}`),fetch(`/api/runs?detection_id=${a.detection_id}`)]);g(await b.json()),k((await c.json()).filter(a=>"HELD_OUT_EVAL"===a.split_type)),m((await d.json()).filter(a=>"completed"===a.status&&"HELD_OUT_EVAL"===a.split_type))},[a.detection_id]),A=async()=>{if(!b)return void alert("Set your Gemini API key first");if(!n||!p)return void alert("Select a prompt version and dataset");let d=i.find(a=>a.dataset_id===p);if(d&&"HELD_OUT_EVAL"!==d.split_type)return void alert("Only HELD_OUT_EVAL datasets can be used here");s(!0),u("Running held-out evaluation..."),w(null);try{let d=await fetch("/api/runs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:b,model_override:c,prompt_version_id:n,dataset_id:p,detection_id:a.detection_id})}),e=await d.json(),f=await fetch(`/api/runs?run_id=${e.run_id}`),g=await f.json();w(g),z()}catch(a){console.error(a),alert("Evaluation failed")}s(!1),u("")},C=async()=>{if(!v)return;let d=a.metric_thresholds,e=v.metrics_summary,f=[];if(null!=d.min_precision&&e.precision<d.min_precision&&f.push(`Precision ${(100*e.precision).toFixed(1)}% < ${(100*d.min_precision).toFixed(1)}%`),null!=d.min_recall&&e.recall<d.min_recall&&f.push(`Recall ${(100*e.recall).toFixed(1)}% < ${(100*d.min_recall).toFixed(1)}%`),null!=d.min_f1&&e.f1<d.min_f1&&f.push(`F1 ${(100*e.f1).toFixed(1)}% < ${(100*d.min_f1).toFixed(1)}%`),f.length>0)return void alert(`Cannot approve: thresholds not met.

${f.join("\n")}`);y(!0);let g=await fetch(`/api/datasets?detection_id=${a.detection_id}`),h=(await g.json()).find(a=>"GOLDEN"===a.split_type);if(h&&b){let e=await fetch("/api/runs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:b,model_override:c,prompt_version_id:v.prompt_version_id,dataset_id:h.dataset_id,detection_id:a.detection_id})}),f=await e.json(),g=null;if(a.approved_prompt_version){let b=l.filter(b=>b.prompt_version_id===a.approved_prompt_version);b.length>0&&(g=b[0].metrics_summary)}if(!function(a,b,c){if(null!=b.min_precision&&a.precision<b.min_precision||null!=b.min_recall&&a.recall<b.min_recall||null!=b.min_f1&&a.f1<b.min_f1)return!1;if(c){let d=b.primary_metric||"f1";if(a[d]<c[d])return!1}return!0}(f.metrics,d,g)){alert("Golden regression FAILED. Cannot approve this prompt version."),y(!1);return}await fetch("/api/prompts",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt_version_id:v.prompt_version_id,golden_set_regression_result:{passed:!0,run_id:f.run_id,metrics:f.metrics,previous_metrics:g,evaluated_at:new Date().toISOString()}})})}await fetch("/api/detections",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({detection_id:a.detection_id,display_name:a.display_name,description:a.description,label_policy:a.label_policy,decision_rubric:a.decision_rubric,metric_thresholds:a.metric_thresholds,approved_prompt_version:v.prompt_version_id})}),alert("Prompt version APPROVED!"),y(!1),z()};return(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Held-Out Evaluation"}),(0,d.jsx)("div",{className:"bg-yellow-900/20 border border-yellow-800/50 rounded-lg p-4 text-sm text-yellow-400",children:"This tab is for final evaluation only. HELD_OUT_EVAL datasets cannot be used for prompt iteration. Results are stored permanently as run artifacts."}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs text-gray-400 font-medium mb-2",children:"Prompt Version"}),(0,d.jsx)("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:f.map(b=>(0,d.jsxs)("label",{className:`flex items-center gap-2 p-2 rounded border cursor-pointer text-sm ${n===b.prompt_version_id?"border-blue-600 bg-blue-900/20":"border-gray-700 bg-gray-900/30 hover:border-gray-600"}`,children:[(0,d.jsx)("input",{type:"radio",name:"prompt",checked:n===b.prompt_version_id,onChange:()=>o(b.prompt_version_id)}),(0,d.jsx)("span",{children:b.version_label}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:b.model}),b.prompt_version_id===a.approved_prompt_version&&(0,d.jsx)("span",{className:"text-xs text-green-400 ml-auto",children:"APPROVED"}),b.golden_set_regression_result&&(0,d.jsxs)("span",{className:`text-xs ml-1 ${b.golden_set_regression_result.passed?"text-green-400":"text-red-400"}`,children:["Reg: ",b.golden_set_regression_result.passed?"PASS":"FAIL"]})]},b.prompt_version_id))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xs text-gray-400 font-medium mb-2",children:"HELD_OUT_EVAL Dataset"}),(0,d.jsxs)("div",{className:"space-y-1.5",children:[i.map(a=>(0,d.jsxs)("label",{className:`flex items-center gap-2 p-2 rounded border cursor-pointer text-sm ${p===a.dataset_id?"border-purple-600 bg-purple-900/20":"border-gray-700 bg-gray-900/30 hover:border-gray-600"}`,children:[(0,d.jsx)("input",{type:"radio",name:"ho-dataset",checked:p===a.dataset_id,onChange:()=>q(a.dataset_id)}),(0,d.jsx)("span",{children:a.name}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:[a.size," images"]}),(0,d.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-purple-900/30 text-purple-400 ml-auto",children:"HELD_OUT"})]},a.dataset_id)),0===i.length&&(0,d.jsx)("p",{className:"text-xs text-gray-500 py-3",children:"No HELD_OUT_EVAL datasets. Upload one in the Detection Setup tab."})]})]})]}),(0,d.jsxs)("div",{className:"mt-4 flex items-center gap-4",children:[(0,d.jsx)("button",{onClick:A,disabled:r||!n||!p,className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 disabled:opacity-50 disabled:cursor-not-allowed rounded text-sm font-medium",children:r?"Running...":"Run Held-Out Evaluation"}),t&&(0,d.jsx)("span",{className:"text-sm text-gray-400",children:t})]})]}),v&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)(j,{metrics:v.metrics_summary,label:"Held-Out Evaluation Results"}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Threshold Check"}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[null!=a.metric_thresholds.min_precision&&(0,d.jsx)(B,{label:"Precision",value:v.metrics_summary.precision,threshold:a.metric_thresholds.min_precision}),null!=a.metric_thresholds.min_recall&&(0,d.jsx)(B,{label:"Recall",value:v.metrics_summary.recall,threshold:a.metric_thresholds.min_recall}),null!=a.metric_thresholds.min_f1&&(0,d.jsx)(B,{label:"F1",value:v.metrics_summary.f1,threshold:a.metric_thresholds.min_f1})]})]}),(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)("button",{onClick:C,disabled:x,className:"px-4 py-2 bg-green-600 hover:bg-green-500 disabled:opacity-50 rounded text-sm font-medium",children:x?"Approving...":"Approve Prompt Version"}),(0,d.jsx)("button",{onClick:()=>{if(!v?.predictions)return;let a=new Blob([["image_id,ground_truth,prediction,confidence,evidence,parse_ok",...v.predictions.map(a=>[a.image_id,a.ground_truth_label,a.predicted_decision||"PARSE_FAIL",a.confidence??"",a.evidence||"",a.parse_ok].join(","))].join("\n")],{type:"text/csv"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`held-out-eval-${v.run_id.slice(0,8)}.csv`,c.click()},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm",children:"Export CSV"}),(0,d.jsx)("button",{onClick:()=>{if(!v)return;let a=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`held-out-eval-${v.run_id.slice(0,8)}.json`,c.click()},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm",children:"Export JSON"})]}),(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium mb-3",children:["Image-Level Results (",v.predictions?.length||0,")"]}),(0,d.jsx)("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{className:"sticky top-0 bg-gray-800",children:(0,d.jsxs)("tr",{className:"text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Image"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Ground Truth"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Prediction"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Correct"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Confidence"}),(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Evidence"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Parse"})]})}),(0,d.jsx)("tbody",{children:(v.predictions||[]).map(a=>{let b=a.parse_ok&&a.predicted_decision===a.ground_truth_label;return(0,d.jsxs)("tr",{className:`border-b border-gray-800/50 ${!b?"bg-red-900/5":""}`,children:[(0,d.jsx)("td",{className:"py-1.5 px-3 font-mono",children:a.image_id}),(0,d.jsx)("td",{className:"text-center py-1.5 px-3",children:(0,d.jsx)("span",{className:`px-1.5 py-0.5 rounded ${"DETECTED"===a.ground_truth_label?"bg-green-900/30 text-green-400":"bg-gray-800 text-gray-400"}`,children:"DETECTED"===a.ground_truth_label?"DET":"NOT"})}),(0,d.jsx)("td",{className:"text-center py-1.5 px-3",children:(0,d.jsx)("span",{className:`px-1.5 py-0.5 rounded ${"DETECTED"===a.predicted_decision?"bg-green-900/30 text-green-400":"NOT_DETECTED"===a.predicted_decision?"bg-gray-800 text-gray-400":"bg-red-900/30 text-red-400"}`,children:a.predicted_decision||"FAIL"})}),(0,d.jsx)("td",{className:"text-center py-1.5 px-3",children:b?(0,d.jsx)("span",{className:"text-green-400",children:"✓"}):(0,d.jsx)("span",{className:"text-red-400",children:"✗"})}),(0,d.jsx)("td",{className:"text-right py-1.5 px-3",children:null!=a.confidence?a.confidence.toFixed(2):"—"}),(0,d.jsx)("td",{className:"py-1.5 px-3 text-gray-400 max-w-[200px] truncate",children:a.evidence||"—"}),(0,d.jsx)("td",{className:"text-center py-1.5 px-3",children:a.parse_ok?(0,d.jsx)("span",{className:"text-green-400",children:"OK"}):(0,d.jsx)("span",{className:"text-red-400",children:"FAIL"})})]},a.prediction_id)})})]})})]})]}),l.length>0&&(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-5",children:[(0,d.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Held-Out Run History"}),(0,d.jsx)("div",{className:"space-y-2",children:l.map(a=>{let b=f.find(b=>b.prompt_version_id===a.prompt_version_id);return(0,d.jsxs)("div",{className:"border border-gray-700 bg-gray-900/30 rounded p-3 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,d.jsx)("span",{className:"font-mono text-xs text-gray-400",children:a.run_id.slice(0,8)}),(0,d.jsx)("span",{className:"text-xs",children:b?.version_label||"?"})]}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleString()})]}),(0,d.jsxs)("div",{className:"flex gap-4 mt-1 text-xs text-gray-400",children:[(0,d.jsxs)("span",{children:["F1: ",(0,d.jsxs)("b",{className:"text-yellow-400",children:[(100*(a.metrics_summary?.f1||0)).toFixed(1),"%"]})]}),(0,d.jsxs)("span",{children:["Precision: ",(0,d.jsxs)("b",{className:"text-blue-400",children:[(100*(a.metrics_summary?.precision||0)).toFixed(1),"%"]})]}),(0,d.jsxs)("span",{children:["Recall: ",(0,d.jsxs)("b",{className:"text-green-400",children:[(100*(a.metrics_summary?.recall||0)).toFixed(1),"%"]})]})]})]},a.run_id)})})]})]})}function B({label:a,value:b,threshold:c}){let e=b>=c;return(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("span",{className:`text-lg ${e?"text-green-400":"text-red-400"}`,children:e?"✓":"✗"}),(0,d.jsx)("span",{className:"text-gray-300 w-20",children:a}),(0,d.jsxs)("span",{className:"font-mono",children:[(100*b).toFixed(1),"%"]}),(0,d.jsx)("span",{className:"text-gray-500",children:"≥"}),(0,d.jsxs)("span",{className:"font-mono text-gray-400",children:[(100*c).toFixed(1),"%"]})]})}function C({detections:a}){let[b,c]=(0,e.useState)(a),[f,g]=(0,e.useState)(new Map),[h,i]=(0,e.useState)(null),[k,l]=(0,e.useState)(!0);return((0,e.useCallback)(async()=>{l(!0);let a=new Map;await Promise.all(b.map(async b=>{let[c,d,e]=await Promise.all([fetch(`/api/prompts?detection_id=${b.detection_id}`),fetch(`/api/datasets?detection_id=${b.detection_id}`),fetch(`/api/runs?detection_id=${b.detection_id}`)]);a.set(b.detection_id,{prompts:await c.json(),datasets:await d.json(),runs:(await e.json()).filter(a=>"completed"===a.status)})})),g(a),l(!1)},[b]),k)?(0,d.jsx)("div",{className:"max-w-7xl mx-auto py-12 text-center text-gray-500",children:(0,d.jsx)("p",{className:"text-sm",children:"Loading detection data..."})}):(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:"Detection Dashboard"}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Overview of all saved detections with latest run outcomes"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,d.jsx)(D,{label:"Total Detections",value:b.length.toString(),color:"text-white"}),(0,d.jsx)(D,{label:"With Approved Prompts",value:b.filter(a=>a.approved_prompt_version).length.toString(),color:"text-green-400"}),(0,d.jsx)(D,{label:"Total Runs",value:Array.from(f.values()).reduce((a,b)=>a+b.runs.length,0).toString(),color:"text-blue-400"}),(0,d.jsx)(D,{label:"Total Datasets",value:Array.from(f.values()).reduce((a,b)=>a+b.datasets.length,0).toString(),color:"text-purple-400"})]}),(0,d.jsx)("div",{className:"space-y-3",children:b.map(a=>{let b=f.get(a.detection_id),c=b?.runs[0],e=c?.metrics_summary||null,g=b?.prompts.find(b=>b.prompt_version_id===a.approved_prompt_version),k=h===a.detection_id;return(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg overflow-hidden",children:[(0,d.jsx)("div",{className:"px-5 py-4 cursor-pointer hover:bg-gray-800/70 transition-colors",onClick:()=>i(k?null:a.detection_id),children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,d.jsx)("svg",{className:`w-4 h-4 text-gray-500 transition-transform shrink-0 ${k?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,d.jsxs)("div",{className:"min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("h3",{className:"font-medium text-gray-200 truncate",children:a.display_name}),(0,d.jsx)("code",{className:"text-xs text-gray-500 bg-gray-900 px-1.5 py-0.5 rounded shrink-0",children:a.detection_code})]}),(0,d.jsx)("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:a.description})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4 shrink-0 ml-4",children:[a.approved_prompt_version?(0,d.jsxs)("span",{className:"text-xs bg-green-900/25 text-green-400 border border-green-800/40 px-2.5 py-1 rounded-full",children:["Approved: ",g?.version_label||"?"]}):(0,d.jsx)("span",{className:"text-xs bg-gray-800 text-gray-500 border border-gray-700 px-2.5 py-1 rounded-full",children:"No approved prompt"}),e&&(0,d.jsxs)("div",{className:"flex gap-3 text-xs",children:[(0,d.jsxs)("span",{children:["P:"," ",(0,d.jsxs)("b",{className:"text-blue-400",children:[(100*e.precision).toFixed(1),"%"]})]}),(0,d.jsxs)("span",{children:["R:"," ",(0,d.jsxs)("b",{className:"text-green-400",children:[(100*e.recall).toFixed(1),"%"]})]}),(0,d.jsxs)("span",{children:["F1:"," ",(0,d.jsxs)("b",{className:"text-yellow-400",children:[(100*e.f1).toFixed(1),"%"]})]})]}),!e&&(0,d.jsx)("span",{className:"text-xs text-gray-600",children:"No runs yet"}),(0,d.jsxs)("div",{className:"flex gap-2 text-xs text-gray-500",children:[(0,d.jsxs)("span",{children:[b?.prompts.length||0," prompts"]}),(0,d.jsx)("span",{className:"text-gray-700",children:"|"}),(0,d.jsxs)("span",{children:[b?.datasets.length||0," datasets"]}),(0,d.jsx)("span",{className:"text-gray-700",children:"|"}),(0,d.jsxs)("span",{children:[b?.runs.length||0," runs"]})]})]})]})}),k&&b&&(0,d.jsxs)("div",{className:"border-t border-gray-700 px-5 py-5 space-y-5 bg-gray-900/20",children:[e&&(0,d.jsx)(j,{metrics:e,label:`Latest Run — ${c?.split_type} — ${new Date(c?.created_at).toLocaleString()}`}),(0,d.jsxs)("div",{className:"bg-gray-800/40 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:"Metric Thresholds"}),(0,d.jsxs)("div",{className:"flex gap-6 text-sm",children:[(0,d.jsxs)("span",{className:"text-gray-400",children:["Primary: ",(0,d.jsx)("b",{className:"text-gray-200",children:a.metric_thresholds.primary_metric})]}),null!=a.metric_thresholds.min_precision&&(0,d.jsx)(E,{label:"Precision",threshold:a.metric_thresholds.min_precision,actual:e?.precision}),null!=a.metric_thresholds.min_recall&&(0,d.jsx)(E,{label:"Recall",threshold:a.metric_thresholds.min_recall,actual:e?.recall}),null!=a.metric_thresholds.min_f1&&(0,d.jsx)(E,{label:"F1",threshold:a.metric_thresholds.min_f1,actual:e?.f1})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:["Run History (",b.runs.length,")"]}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full text-xs",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"text-gray-500 border-b border-gray-700",children:[(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Run"}),(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Prompt"}),(0,d.jsx)("th",{className:"text-center py-2 px-3",children:"Split"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Precision"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Recall"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"F1"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Accuracy"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Parse Fail"}),(0,d.jsx)("th",{className:"text-right py-2 px-3",children:"Images"}),(0,d.jsx)("th",{className:"text-left py-2 px-3",children:"Date"})]})}),(0,d.jsx)("tbody",{children:b.runs.slice(0,20).map(a=>{let c=a.metrics_summary,e=b.prompts.find(b=>b.prompt_version_id===a.prompt_version_id);return(0,d.jsxs)("tr",{className:"border-b border-gray-800/50 hover:bg-gray-800/30",children:[(0,d.jsx)("td",{className:"py-2 px-3 font-mono text-gray-400",children:a.run_id.slice(0,8)}),(0,d.jsx)("td",{className:"py-2 px-3",children:(0,d.jsx)("span",{className:"text-gray-300",children:e?.version_label||"?"})}),(0,d.jsx)("td",{className:"text-center py-2 px-3",children:(0,d.jsx)("span",{className:`px-1.5 py-0.5 rounded ${function(a){switch(a){case"GOLDEN":return"bg-yellow-900/30 text-yellow-400";case"ITERATION":return"bg-blue-900/30 text-blue-400";case"HELD_OUT_EVAL":return"bg-purple-900/30 text-purple-400";default:return"bg-gray-800 text-gray-400"}}(a.split_type)}`,children:a.split_type})}),(0,d.jsxs)("td",{className:"text-right py-2 px-3 text-blue-400",children:[(100*c.precision).toFixed(1),"%"]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3 text-green-400",children:[(100*c.recall).toFixed(1),"%"]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3 text-yellow-400 font-medium",children:[(100*c.f1).toFixed(1),"%"]}),(0,d.jsxs)("td",{className:"text-right py-2 px-3 text-gray-300",children:[(100*c.accuracy).toFixed(1),"%"]}),(0,d.jsx)("td",{className:"text-right py-2 px-3",children:(0,d.jsxs)("span",{className:c.parse_failure_rate>0?"text-yellow-400":"text-gray-500",children:[(100*c.parse_failure_rate).toFixed(1),"%"]})}),(0,d.jsx)("td",{className:"text-right py-2 px-3 text-gray-400",children:c.total}),(0,d.jsx)("td",{className:"py-2 px-3 text-gray-500",children:new Date(a.created_at).toLocaleString()})]},a.run_id)})})]})}),0===b.runs.length&&(0,d.jsx)("p",{className:"text-xs text-gray-600 text-center py-4",children:"No completed runs"})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("h4",{className:"text-xs text-gray-500 font-medium mb-2",children:["Prompt Versions (",b.prompts.length,")"]}),(0,d.jsx)("div",{className:"space-y-1.5",children:b.prompts.map(b=>(0,d.jsxs)("div",{className:`flex items-center justify-between px-3 py-2 rounded border text-xs ${b.prompt_version_id===a.approved_prompt_version?"border-green-800/50 bg-green-900/10":"border-gray-700 bg-gray-900/20"}`,children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("span",{className:"font-medium text-gray-300",children:b.version_label}),(0,d.jsxs)("span",{className:"text-gray-500",children:[b.model," | temp=",b.temperature]}),b.prompt_version_id===a.approved_prompt_version&&(0,d.jsx)("span",{className:"text-green-400 font-medium",children:"APPROVED"}),b.golden_set_regression_result&&(0,d.jsxs)("span",{className:b.golden_set_regression_result.passed?"text-green-400":"text-red-400",children:["Reg: ",b.golden_set_regression_result.passed?"PASS":"FAIL"]})]}),(0,d.jsxs)("span",{className:"text-gray-500",children:[b.created_by," — ",new Date(b.created_at).toLocaleDateString()]})]},b.prompt_version_id))})]})]})]},a.detection_id)})}),0===b.length&&(0,d.jsx)("div",{className:"text-center py-16 text-gray-500",children:(0,d.jsx)("p",{className:"text-sm",children:"No detections found. Create one in the Detection Setup tab."})})]})}function D({label:a,value:b,color:c}){return(0,d.jsxs)("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3",children:[(0,d.jsx)("div",{className:`text-2xl font-bold ${c}`,children:b}),(0,d.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:a})]})}function E({label:a,threshold:b,actual:c}){let e=null!=c?c>=b:null;return(0,d.jsxs)("span",{className:"text-xs text-gray-400",children:[a," ≥ ",(100*b).toFixed(0),"%",null!=e&&(0,d.jsx)("span",{className:`ml-1 ${e?"text-green-400":"text-red-400"}`,children:e?"✓":"✗"})]})}let F=[{label:"Detection Setup",id:0,step:"1",description:"Define detections, run, and iterate"},{label:"HIL Review",id:1,step:"2",description:"Correct predictions"},{label:"Prompt Feedback",id:2,step:"3",description:"Recompute and improve prompts"},{label:"Prompt Compare",id:3,step:"4",description:"Compare baseline vs improved prompts"},{label:"Held-Out Eval",id:4,step:"5",description:"Final eval and regression gate"},{label:"Datasets",id:5,step:"6",description:"Manage dataset splits and items"},{label:"Saved Detections",id:6,step:"",description:"Detection portfolio overview"}];function G(){let{activeTab:a,setActiveTab:b,selectedDetectionId:c,setSelectedDetectionId:f,apiKey:g,setApiKey:j,selectedModel:k,setSelectedModel:m}=h(),[n,p]=(0,e.useState)([]),[q,r]=(0,e.useState)(!1),[s,u]=(0,e.useState)(i),[v,y]=(0,e.useState)(!1),z=(0,e.useCallback)(async()=>{let a=await fetch("/api/detections"),b=await a.json();p(b),b.length>0&&!c&&f(b[0].detection_id)},[c,f]),B=n.find(a=>a.detection_id===c);return(0,d.jsxs)("div",{className:"flex h-screen",children:[(0,d.jsxs)("aside",{className:"w-60 bg-gray-900 border-r border-gray-800 flex flex-col shrink-0",children:[(0,d.jsxs)("div",{className:"px-5 py-4 border-b border-gray-800",children:[(0,d.jsx)("h1",{className:"text-base font-semibold text-white tracking-tight",children:"VLM Eval"}),(0,d.jsx)("p",{className:"text-[10px] text-gray-500 mt-0.5 tracking-wide uppercase",children:"Detection Evaluator"})]}),(0,d.jsxs)("nav",{className:"flex-1 overflow-y-auto py-3",children:[(0,d.jsx)("p",{className:"px-4 mb-2 text-[10px] font-semibold text-gray-600 uppercase tracking-widest",children:"Workflow"}),F.filter(a=>a.step).map((c,e,f)=>{let g=a===c.id;return(0,d.jsxs)("button",{onClick:()=>b(c.id),className:`w-full flex items-start gap-3 px-4 py-2.5 text-left transition-colors group relative ${g?"bg-blue-900/20 text-white":"text-gray-400 hover:bg-gray-800/50 hover:text-gray-200"}`,children:[g&&(0,d.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-blue-500"}),(0,d.jsx)("div",{className:`w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold shrink-0 mt-0.5 ${g?"bg-blue-600 text-white":"bg-gray-800 text-gray-500 border border-gray-700"}`,children:c.step}),(0,d.jsxs)("div",{className:"min-w-0",children:[(0,d.jsx)("span",{className:`text-sm font-medium block leading-tight ${g?"text-white":""}`,children:c.label}),(0,d.jsx)("span",{className:"text-[10px] text-gray-600 block mt-0.5 leading-tight",children:c.description})]}),e<f.length-1&&(0,d.jsx)("div",{className:"absolute left-[30px] -bottom-[2px] w-px h-[6px] bg-gray-800"})]},c.id)}),(0,d.jsx)("div",{className:"mx-4 my-3 border-t border-gray-800"}),F.filter(a=>!a.step).map(c=>{let e=a===c.id;return(0,d.jsxs)("button",{onClick:()=>b(c.id),className:`w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors relative ${e?"bg-blue-900/20 text-white":"text-gray-400 hover:bg-gray-800/50 hover:text-gray-200"}`,children:[e&&(0,d.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-blue-500"}),(0,d.jsx)("svg",{className:`w-4 h-4 shrink-0 ${e?"text-blue-400":"text-gray-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:`text-sm font-medium ${e?"text-white":""}`,children:c.label}),(0,d.jsx)("span",{className:"text-[10px] text-gray-600 block mt-0.5",children:c.description})]})]},c.id)})]}),(0,d.jsxs)("div",{className:"border-t border-gray-800 p-4 space-y-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-[10px] text-gray-500 font-medium uppercase tracking-wider block mb-1",children:"Active Detection"}),(0,d.jsxs)("select",{className:"w-full bg-gray-800 border border-gray-700 text-xs rounded px-2.5 py-1.5 text-gray-200 focus:outline-none focus:border-blue-500",value:c||"",onChange:a=>f(a.target.value||null),children:[(0,d.jsx)("option",{value:"",children:"Select Detection"}),n.map(a=>(0,d.jsx)("option",{value:a.detection_id,children:a.display_name},a.detection_id))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-[10px] text-gray-500 font-medium uppercase tracking-wider block mb-1",children:"Gemini Model"}),(0,d.jsx)("select",{className:"w-full bg-gray-800 border border-gray-700 text-xs rounded px-2.5 py-1.5 text-gray-200 focus:outline-none focus:border-blue-500",value:k,onChange:a=>m(a.target.value),children:s.map(a=>(0,d.jsx)("option",{value:a,children:a},a))}),(0,d.jsx)("p",{className:"text-[10px] text-gray-600 mt-1",children:v?"Loading available models...":"Models discovered from your API key."})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("button",{onClick:()=>r(!q),className:`w-full text-xs px-2.5 py-1.5 rounded border text-left ${g?"border-green-800/50 text-green-400 bg-green-900/15":"border-yellow-800/50 text-yellow-400 bg-yellow-900/15"}`,children:g?"Gemini API Key Set":"Set Gemini API Key"}),q&&(0,d.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 bg-gray-800 border border-gray-700 rounded-lg p-3 z-50 shadow-xl w-72",children:[(0,d.jsx)("label",{className:"text-xs text-gray-400 block mb-1",children:"Gemini API Key"}),(0,d.jsx)("input",{type:"password",className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:outline-none focus:border-blue-500",value:g,onChange:a=>j(a.target.value),placeholder:"AIza..."}),(0,d.jsx)("p",{className:"text-[10px] text-gray-500 mt-1",children:"Stored in memory only."}),(0,d.jsx)("button",{onClick:()=>r(!1),className:"mt-2 text-xs text-blue-400 hover:text-blue-300",children:"Close"})]})]})]})]}),(0,d.jsxs)("main",{className:"flex-1 overflow-auto bg-gray-950 flex flex-col",children:[(0,d.jsxs)("div",{className:"border-b border-gray-800 bg-gray-900/40 px-6 py-2.5 flex items-center justify-between shrink-0",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("h2",{className:"text-sm font-medium text-gray-200",children:F.find(b=>b.id===a)?.label}),B&&6!==a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"text-gray-700",children:"|"}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:B.display_name}),(0,d.jsx)("code",{className:"text-[10px] text-gray-600 bg-gray-800 px-1.5 py-0.5 rounded",children:B.detection_code})]})]}),B?.approved_prompt_version&&6!==a&&(0,d.jsx)("span",{className:"text-[10px] bg-green-900/20 text-green-500 border border-green-800/40 px-2 py-0.5 rounded",children:"Approved prompt active"})]}),(0,d.jsx)("div",{className:"flex-1 overflow-auto p-6",children:c||0===a||6===a?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:0===a?"block":"hidden",children:(0,d.jsx)(l,{detections:n,selectedDetection:B||null,onRefresh:z})}),B&&(0,d.jsx)("div",{className:1===a?"block":"hidden",children:(0,d.jsx)(t,{detection:B})}),B&&(0,d.jsx)("div",{className:2===a?"block":"hidden",children:(0,d.jsx)(w,{detection:B})}),B&&(0,d.jsx)("div",{className:3===a?"block":"hidden",children:(0,d.jsx)(o,{detection:B})}),B&&(0,d.jsx)("div",{className:4===a?"block":"hidden",children:(0,d.jsx)(A,{detection:B})}),B&&(0,d.jsx)("div",{className:5===a?"block":"hidden",children:(0,d.jsx)(x,{detection:B})}),(0,d.jsx)("div",{className:6===a?"block":"hidden",children:(0,d.jsx)(C,{detections:n})})]}):(0,d.jsxs)("div",{className:"text-center py-20 text-gray-500",children:[(0,d.jsx)("p",{className:"text-lg",children:"Select a detection to get started"}),(0,d.jsx)("p",{className:"text-sm mt-2",children:"Use the sidebar dropdown or create a new detection in Step 1"})]})})]})]})}},9121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9232:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,1170,23)),Promise.resolve().then(c.t.bind(c,3597,23)),Promise.resolve().then(c.t.bind(c,6893,23)),Promise.resolve().then(c.t.bind(c,9748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,9576,23)),Promise.resolve().then(c.t.bind(c,3041,23)),Promise.resolve().then(c.t.bind(c,1384,23))},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[331,361],()=>b(b.s=6018));module.exports=c})();